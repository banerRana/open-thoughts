operators:
  - id: get_openr1_hf
    config:
      type: hf_source
      dataset: open-r1/OpenR1-Math-Raw
      split: train
  - id: select_rows_without_proof
    config:
      type: function
      sharded: true
      num_shards: 32
      function: data_strategies.commons.select_rows_without
      function_config:
        conditions:
          answer: "proof"
    input_ids:
      - get_openr1_hf
  - id: expand_generation
    config:
      type: function
      sharded: true
      num_shards: 32
      function: data_strategies.OpenR1_MultipleSamples.utils.apply_expand_generation
    input_ids:
      - select_rows_without_proof
  - id: remove_columns
    config:
      type: function
      sharded: true
      num_shards: 32
      function: data_strategies.commons.remove_columns
      function_config:
        columns:
          - generations
    input_ids:
      - expand_generation
  - id: extract_math_answer
    config:
      type: generic_resource_function
      memory: 600
      num_cpus: 80
      num_shards: 32
      sharded: true
      function: data_strategies.OpenR1_MultipleSamples.etash_is_tired.multiple_samples_ground_truth_openr1.process_ground_truth
    input_ids:
      - remove_columns
  - id: load_preexisting_all_proofs
    config:
      type: hf_source
      dataset: mlfoundations-dev/open_r1_hf_get_all_proofs
      split: train
  - id: remove_columns_proof
    config:
      type: function
      sharded: true
      num_shards: 32
      function: data_strategies.commons.keep_only_columns
      function_config:
        columns_to_keep:
          - conversations
    input_ids:
      - load_preexisting_all_proofs
  - id: mix
    config:
      type: mix
    input_ids:
      - remove_columns_proof
      - extract_math_answer