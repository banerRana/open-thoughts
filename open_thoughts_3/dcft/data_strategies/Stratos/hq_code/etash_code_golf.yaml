operators:
- id: load_stackexchange_codegolf
  config:
    type: hf_source
    dataset: mlfoundations-dev/stackexchange_codegolf
    split: train
- id: rename_task_column_gsm
  config:
      type: function
      function: data_strategies.commons.force_rename_columns
      function_config:
        column_maps:
            instruction: problem
  input_ids:
    - load_stackexchange_codegolf
- id: sample_dataset
  config:
    type: function
    function: data_strategies.commons.uniform_sample_limited
    function_config:
      num_samples: 4000  # 1.25% of 10000 target from stage 1
  input_ids:
    - rename_task_column_gsm
- id: label_code
  config:
    type: function
    function: data_strategies.commons.add_constant_columns
    function_config:
      source: codegolf
  input_ids:
    - sample_dataset
- id: decontaminate
  config:
    type: cpu_function
    num_cpus: 80
    function:  data_strategies.DeepSeekR1.utils.decontaminate_table
    function_config:
      column: problem
      eval_datasets:
        - HuggingFaceH4/MATH-500
        - Maxwell-Jia/AIME_2024
        - AI-MO/aimo-validation-amc
        - livecodebench/code_generation_lite
      eval_columns:
        - problem
        - Problem
        - problem
        - question_content
      eval_splits:
        - test
        - train
        - train
        - test
      similarity_threshold: 95.0
  input_ids:
    - label_code
- id: fuzzy_dedup
  config:
    type: cpu_function
    num_cpus: 80
    function: data_strategies.DeepSeekR1.utils.fuzzy_dedup
    function_config:
      column: problem
      similarity_threshold: 95.0
  input_ids:
    - decontaminate
