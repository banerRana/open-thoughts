operators: 
  - id: load_preexisting
    config:
      type: load_preexisting
      framework_name: base_get_difficulty_seed_math
  - id: select_difficulty_4
    config:
      type: function
      function: data_strategies.commons.select_rows
      function_config:
        conditions:
          difficulty: 4
    input_ids:
      - load_preexisting
  - id: select_difficulty_3
    config:
      type: function
      function: data_strategies.commons.select_rows
      function_config:
        conditions:
          difficulty: 3
    input_ids:
      - load_preexisting
  - id: select_difficulty_2
    config:
      type: function
      function: data_strategies.commons.select_rows
      function_config:
        conditions:
          difficulty: 2
    input_ids:
      - load_preexisting
  - id: sample_dataset
    config:
      type: function
      function: data_strategies.commons.uniform_sample_limited
      function_config:
        num_samples: 1000 # 1.25% of 6000 target from stage 1
    input_ids:
      - select_difficulty_2
      - select_difficulty_4
      - select_difficulty_3
  - id: annotate
    config:
      type: completions
      map: chat
      map_config:
        user_message_column: instruction_seed
        output_column: r1_distill_70b_response
      model: together_ai/deepseek-ai/DeepSeek-R1-Distill-Llama-70B
      batch: False
      temperature: 1.0
      backend_params:
        max_requests_per_minute: 500
        max_tokens_per_minute: 1_000_000
        invalid_finish_reasons: ['content_filter']
      generation_params:
        max_tokens: 32_000
    input_ids:
      - sample_dataset
  - id: convert_to_sharegpt
    config:
      type: function
      function: data_strategies.commons.convert_instruction_response_to_sharegpt
      function_config:
        input_instruction_column: instruction_seed
        input_response_column: r1_distill_70b_response
        output_sharegpt_column: conversations
    input_ids:
      - annotate