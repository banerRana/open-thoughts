operators:
  - id: create_urls
    config:
      type: function
      function: data_strategies.32b_exploit.seed_pdf_parser.utils.create_url_dataset
      function_config:
        urls:
          - s3://digitalcorpora/corpora/files/CC-MAIN-2021-31-PDF-UNTRUNCATED/zipfiles/0000-0999/0000.zip
          - s3://digitalcorpora/corpora/files/CC-MAIN-2021-31-PDF-UNTRUNCATED/zipfiles/0000-0999/0001.zip
          - s3://digitalcorpora/corpora/files/CC-MAIN-2021-31-PDF-UNTRUNCATED/zipfiles/0000-0999/0002.zip
          - s3://digitalcorpora/corpora/files/CC-MAIN-2021-31-PDF-UNTRUNCATED/zipfiles/0000-0999/0003.zip
          - s3://digitalcorpora/corpora/files/CC-MAIN-2021-31-PDF-UNTRUNCATED/zipfiles/0000-0999/0004.zip
          - s3://digitalcorpora/corpora/files/CC-MAIN-2021-31-PDF-UNTRUNCATED/zipfiles/0000-0999/0005.zip
          - s3://digitalcorpora/corpora/files/CC-MAIN-2021-31-PDF-UNTRUNCATED/zipfiles/0000-0999/0006.zip
  - id: download_digital_corpora
    config:
      type: async_function
      num_shards: 5
      sharded: true
      function: data_strategies.32b_exploit.seed_pdf_parser.utils_commoncrawl.download_digital_corpora
      function_config:
        s3_urls_column: url
    input_ids:
      - create_urls
  # - id: process_urls

  #   config:
  #     type: high_memory_function
  #     num_cpus: 20
  #     num_shards: 6
  #     sharded: true
  #     memory: 200
  #     function: data_strategies.32b_exploit.seed_pdf_parser.utils_commoncrawl.dataset_process_zip_bytes
  #     function_config:
  #       zip_bytes_column: zip_bytes
  #   input_ids:
  #     - download_digital_corpora
  # - id: classify_fasttext
  #   config:
  #     type: fasttext
  #     hf_repo_id: mlfoundations-dev/science_pdf_fasttext_classifier_v2
  #     input_column: text
  #     target_label: "__label__QA_doc"
  #     filter_threshold: 0.5
  #   input_ids:
  #     - create_urls
  # - id: filter_pdfs
  #   config:
  #     type: function
  #     function: data_strategies.commons.filter_dataset_if_value_exists
  #     function_config:
  #       to_filter_column: pdf_file
  #       value_column: pdf_file
  #     input_dataset_map:
  #       to_filter_dataset: create_urls
  #       values_dataset: classify_fasttext
  #   input_ids:
  #       - create_urls
  #       - classify_fasttext
  # - id: remove_non_english_pages
  #   config:
  #     type: function
  #     function: data_strategies.32b_exploit.seed_pdf_parser.utils.flag_english_pages
  #   input_ids:
  #     - filter_pdfs
  # - id: reduce_to_sample_pages_for_annotation
  #   config:
  #     type: function
  #     function: data_strategies.32b_exploit.seed_pdf_parser.utils.sub_sample_page_per_url
  #   input_ids:
  #     - remove_non_english_pages
  # - id: filter_qa_pdfs
  #   config:
  #     type: completions
  #     model: gpt-4o-mini
  #     map: binary_classifier
  #     map_config:
  #       user_message: |
  #         Yes or No, does this pdf contain multiple choice, short answer, or long answer questions?
          
  #         Below is a sampling of a subset of pages from the pdf, determine if there are questions in it. Specifically, questions from a textbook or exams that may appear on homework or tests.
          
  #         We are not interested in rhetorical questions or scientific writing etc. We want actual questions that a student could solve.
          
  #         These questions must be science questions. Specifically involving Physics, Chemistry, or Biology.
          
  #         We provide examples of questions below:
          
  #         ## Example 1
  #         To evaluate the integral of the form I, we have: I = ∫ dx / √(5 + 2x + x²). We can rewrite the expression under the square root as follows: 5 + 2x + x² = 4 + (x + 1)². Thus, we can substitute x + 1 = t, transforming the integral: I = ∫ dt / √(4 + t²). This leads to the substitution of t = 2 tan z. What is the integral of the form I when given I = ∫ dx / √(5 + 2x + x²)?
          
  #         ## Example 2
  #         A tin chloride Q undergoes the following reactions (not balanced): Q + Cl → X, Q + Me3N → Y, Q + CuCl2 → Z + CuCl. X is a monoanion having pyramidal geometry. Both Y and Z are neutral compounds. Choose the correct option(s): (A) The central atom in X is sp³ hybridized (B) There is a coordinate bond in Y (C) The oxidation state of the central atom in Z is +2 (D) The central atom in Z has one lone pair of electrons.
          
  #         ## Example 3
  #         An optical bench has a 1.5 m long scale having four equal divisions in each cm. While measuring the focal length of a convex lens, the lens is kept at the 75 cm mark of the scale and the object pin is kept at the 45 cm mark. The image of the object pin on the other side of the lens overlaps with the image pin that is kept at the 135 cm mark. In this experiment, what is the percentage error in the measurement of the focal length of the lens?
          
  #         ## Example 4
  #         A uniformly charged thin spherical shell of radius R carries uniform surface charge density of σ per unit area. It is made of two hemispherical shells, held together by pressing them with force F (see figure). F is proportional to: A) \(\frac{1}{\varepsilon_0}\sigma^2 R^2\) B) \(\frac{1}{\varepsilon_0}\sigma^2 R\) C) \(\frac{1}{\varepsilon_0 R}\sigma^2\) D) \(\frac{1}{\varepsilon_0 R^2}\sigma^2\) What is F proportional to?
          
  #         ## Example 5
  #         Termites are to termites as gut microbes are to plants. * <bold>A.</bold> Cellulose molecules, water molecules * <bold>B.</bold> Gut microbes, mycorrhizal fungi * <bold>C.</bold> Gut microbes, water molecules * <bold>D.</bold> Hours of darkness, hours of light * <bold>E.</bold> Predators, prey Termites are to termites as [blank] are to plants.                                                                                                                                              
          
  #         ## Your task                                                                                                                                    
  #         Does the below PDF contain questions similar to the examples?
          
  #         ## Sampled PDF text
  #         {{sampled_pdf_text}}
  #       output_column: contains_math_sci_code_content
  #     temperature: 0.0  # From stage 1
  #     top_p: 1.0
  #     presence_penalty: 0.0
  #   input_ids:
  #     - reduce_to_sample_pages_for_annotation
  # - id: filter_to_good_pdfs
  #   config:
  #     type: function
  #     function: data_strategies.commons.select_rows
  #     function_config:
  #       conditions:
  #         contains_math_sci_code_content: True
  #   input_ids:
  #     - filter_qa_pdfs
  # - id: filter_original_pages
  #   config:
  #     type: function
  #     function: data_strategies.32b_exploit.seed_pdf_parser.utils.filter_pdfs_by_page_classification
  #     input_dataset_map:
  #       dataset_with_pages: filter_pdfs
  #       dataset_of_filtered_pdfs: filter_to_good_pdfs
  #   input_ids:
  #     - filter_pdfs
  #     - filter_to_good_pdfs
