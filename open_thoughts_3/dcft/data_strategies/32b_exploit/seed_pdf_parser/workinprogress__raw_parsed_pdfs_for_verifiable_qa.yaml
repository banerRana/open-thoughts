operators:
  - id: create_urls
    config:
      type: function
      function: data_strategies.32b_exploit.seed_pdf_parser.utils.create_url_dataset
      function_config:
        urls:
          - "https://uwaterloo.ca/chemistry/sites/default/files/uploads/documents/avogadro-exam-solution-2011.pdf"
#          - pdf_url:
#              questions_url: "https://uwaterloo.ca/chemistry/sites/default/files/uploads/documents/avogadro-exam-solution-2011.pdf"
#              question_pages:
#                min_page_range: 10
#                max_page_range: 20
#              answers_url: 'abc'
#              answers_pages:
#                min_page_range: 1
#                max_page_range: 3

#          - "https://uwaterloo.ca/chemistry/sites/default/files/uploads/documents/avogadro-exam-solution-2010.pdf"
#          - "https://uwaterloo.ca/chemistry/sites/default/files/uploads/documents/avogadro-exam-solution-2009.pdf"
#          - "https://uwaterloo.ca/chemistry/sites/default/files/uploads/documents/avogadro-exam-solution-2008.pdf"
#          - "https://uwaterloo.ca/chemistry/sites/default/files/uploads/documents/avogadro-exam-solution-2007.pdf"
#          - "https://uwaterloo.ca/chemistry/sites/default/files/uploads/documents/chem-13-news-solution-2011.pdf"
#          - "https://uwaterloo.ca/chemistry/sites/default/files/uploads/documents/chem-13-news-exam-solution-2010.pdf"
#          - "https://uwaterloo.ca/chemistry/sites/default/files/uploads/documents/chem-13-news-exam-solution-2009.pdf"
#          - "https://uwaterloo.ca/chemistry/sites/default/files/uploads/documents/chem-13-news-exam-solution-2008.pdf"
#          - "https://uwaterloo.ca/chemistry/sites/default/files/uploads/documents/chem-13-news-exam-solution-2007.pdf"



#          - "https://biolympiads.com/wp-content/uploads/2015/01/2003_OpenExam_AnswerKey2.pdf"
#          - "http://biolympiads.com/wp-content/uploads/2015/01/2004_OpenExam_AnswerKey4.pdf"
#          - "http://biolympiads.com/wp-content/uploads/2015/01/2005_OpenExam_AnswerKey1.pdf"
#          - "http://biolympiads.com/wp-content/uploads/2015/01/2006_OpenExam_AnsKey2.pdf"
#          - "http://biolympiads.com/wp-content/uploads/2015/01/2007_OpenExam_AnsKey1.pdf"
#          - "http://biolympiads.com/wp-content/uploads/2015/01/2008_OpenExam_AnsKey1.pdf"
#          - "http://biolympiads.com/wp-content/uploads/2015/01/2009_OpenExam_AnsKey1.pdf"
#          - "http://biolympiads.com/wp-content/uploads/2015/01/2010_OpenExam_AnsKey3.pdf"
#          - "http://biolympiads.com/wp-content/uploads/2015/01/2011_OpenExam_AnsKey.pdf"
#          - "http://biolympiads.com/wp-content/uploads/2015/01/2012_OpenExam_AnsKey2.pdf"
#          - "https://www.asi.edu.au/wp-content/uploads/2024/02/ASOE-Chemistry-2023-Exam-Paper-with-Answers.pdf"
#          - "https://www.asi.edu.au/wp-content/uploads/2023/05/ASOE-Chemistry-2022-ASDAN-answers.pdf"
#          - "https://www.asi.edu.au/wp-content/uploads/2023/05/ASOE_Chemistry_2021_answers_reduced-FS.pdf"
#          - "https://www.asi.edu.au/wp-content/uploads/2022/12/2020-asoe-chemistry-exam-answers.pdf"
#          - "https://www.asi.edu.au/wp-content/uploads/2022/12/2019-asoe-chemistry-exam-answers.pdf"
#          - "https://www.asi.edu.au/wp-content/uploads/2022/12/2018-asoe-chemistry-exam-answers.pdf"
#          - "https://www.andrews.edu/~rwright/physics/OpenStax%20Physics-Student%20Solution%20Manual.pdf"
#          - "https://reanphysics.wordpress.com/wp-content/uploads/2018/11/raymond_a-_serway_john_w-_jewett_student_solutibookzz-org.pdf"
#          - "https://carrollscaveofknowledge.weebly.com/uploads/2/0/2/8/20287891/physics_11_regular_year_solutions_manual.pdf"
#          - "https://doctor2019.jumedicine.com/wp-content/uploads/sites/10/2019/09/Giancoli-Physics-Principles-With-Applications-7th-c2014-solutions-ISM.pdf"

#
#  - id: get_pdf_bytes
#    config:
#      shard: True
#      num_shards: 1
#      type: function
#      function: data_strategies.32b_exploit.seed_pdf_parser.utils.download_pdfs
#    input_ids:
#      - create_urls
#  - id: process_pdfs
#    config:
#      sharded: True
#      num_shards: 1
#      type: async_function
#      function: data_strategies.32b_exploit.seed_pdf_parser.utils.get_all_page_counts
#    input_ids:
#      - get_pdf_bytes
#  - id: get_page_bytes
#    config:
#      type: cpu_function
#      num_cpus: 40
#      sharded: true
#      num_shards: 1
#      function: data_strategies.32b_exploit.seed_pdf_parser.utils.expand_and_extract_pages
#      function_config:
#        page_count_column: page_count
#    input_ids:
#      - process_pdfs
#  - id: drop_columns
#    config:
#      type: function
#      sharded: True
#      num_shards: 1
#      function: data_strategies.commons.remove_columns
#      function_config:
#        columns:
#          - pdf_bytes
#    input_ids:
#      - get_page_bytes
#  - id: generate_plan_instructions
#    config:
#      type: completions
#      map: gemini_ocr
#      map_config:
#        pdf_url_column: "url"
#        output_extraction_column: "output_extraction"
#        page_number_column: "page_number"
#      model: "gemini/gemini-2.0-flash-lite-preview-02-05"
#      backend_params:
#        invalid_finish_reasons: ["content_filter"]
#        max_requests_per_minute: 4_000
#        max_tokens_per_minute: 4_000_000
#    input_ids:
#      - drop_columns
#  - id: get_question_choices_and_solutions
#    config:
#      type: completions
#      map: chat
#      map_config:
#        user_message: |
#          Extract the questions, answer choices, and solutions from the extracted text from the pdf below.
#
#          Format your response as below:
#            QUESTION: "the question from the text and all relevant context excluding the answer and choices" (i.e. if the question is "What was Elvis Presley's (a) favorite sandwich? (b) most hated song? (c) birthday?" You should have a question "QUESTION: What was Elvis Presley's favorite sandwich..." and then another question "QUESTION: What was Elvis Presley's most hated song?..."  etc.)
#            ANSWER CHOICES: "answer choice 1" ||| "answer choice 2" ... (if no answer choices are available just say "free response", if answer choices are available please write them out i.e. "A: 0.57 ||| B: John Hancock ||| ..." etc.)
#            SOLUTION: "correct answer choice" or "free response answer". If you cannot determine the correct solution say "NO ANSWER DETECTED"
#
#          It is important that each QUESTION: is self contained, meaning, if you were to read "QUESTION: ..." by itself, you should be able to answer it. Given the example "What was Elvis Presley's (a) favorite sandwich? (b) most hated song? (c) birthday?", you should NOT say "QUESTION: favorite sandwich?" as this makes no sense. Instead you should say "QUESTION: What was Elvis Presley's favorite sandwich?"
#          To be clear. All questions with subquestions should be restated as individual questions themselves with all relevant information required to answer them.
#          Only break up the subquestions.  I.E. only break up questions that have (a) (b) and (c) or (1) (2) and (3), do not break up questions that do not have markers indicating they have parts or subquestions please.
#          We are creating a bank of questions that are automatically extracted from pdfs, so it is imperative you get this right.
#          ---
#          Extracted Text:
#
#          {{output_extraction}}
#          """
#        output_column: question_choices_solutions
#      model: gpt-4o-mini
#    input_ids:
#      - generate_plan_instructions
#  - id: split_qas
#    config:
#      shard: True
#      num_shards: 1
#      type: function
#      function: data_strategies.32b_exploit.pdf_helper.process_extracted_questions
#    input_ids:
#      - get_question_choices_and_solutions
#  - id: generate_questions_improved
#    config:
#      type: completions
#      map: chat
#      map_config:
#        user_message: |
#          You are an instructor creating exam questions.
#          I will provide you with a given question and the text from which it was extracted from.
#          You will ensure that the question is answerable, meaning that there is enough context to answer the question.
#          To do this, you will look at the extracted text and ensure that nothing is missing from the current questions instantiation. If there is, you will provide the new extra text before restating the question but be sure you always add the question itself at the end.
#          Because you are an instructor creating exam questions, you will never include the solution in the extra text or question.
#
#          Here is an example of your task:
#          Extracted Question: Calculate the chemical amount (in mol or mmol) of nitric acid that reacts with the
#            5.000 g sample of this mineral.
#          Extracted Text: A sample of a different mineral is analysed by the same methods. This mineral also contains only Pb2+, CO3 2−, OH− and O2− ions.
#            When a 5.000 g sample of this mineral is treated with 25.00 mL of 2.000 mol L−1 nitric acid
#            (HNO3), 0.5214 g of carbon dioxide is released, and 0.01051 mol of the acid remains.
#            When subjected to thermal decomposition, 5.000 g of this mineral loses 0.5926 g.
#            (g) Calculate the chemical amount (in mol or mmol) of nitric acid that reacts with the
#            5.000 g sample of this mineral.
#
#          You would tell me:
#
#          A sample of a different mineral is analysed by the same methods. This mineral also contains only Pb2+, CO3 2−, OH− and O2− ions.
#            When a 5.000 g sample of this mineral is treated with 25.00 mL of 2.000 mol L−1 nitric acid
#            (HNO3), 0.5214 g of carbon dioxide is released, and 0.01051 mol of the acid remains.
#            When subjected to thermal decomposition, 5.000 g of this mineral loses 0.5926 g. Calculate the chemical amount (in mol or mmol) of nitric acid that reacts with the
#            5.000 g sample of this mineral.
#
#          ---
#
#          Here is the question: {{extracted_question}}
#          Here is the extracted text: {{output_extraction}}
#
#          ---
#
#          Do not include any filler like "here is the improved question". Include only the relevant information and the question itself. Include all answer choices if applicable.
#          Do not include the solution if you see it. This is an exam, so you should NOT include the final answer in the question.
#          """
#        output_column: improved_question_solution
#      model: gpt-4o-mini
#    input_ids:
#      - split_qas