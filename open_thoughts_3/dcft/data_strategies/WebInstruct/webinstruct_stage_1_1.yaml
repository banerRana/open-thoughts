operators:
  - id: load_stemez_html
    config:
      type: json_source
      file: gs://dcft-data-gcp/scraper/stemez/stemez_content.json
      num_truncate: 100_000

  - id: parse_stemez_html
    config:
      type: function
      function: data_strategies.WebInstruct.utils.parse_html
      function_config:
        input_column: html
        output_column: extracted_text
        remove_columns: [html, timestamp]
    input_ids:
      - load_stemez_html

  - id: clean_stemez_text
    config:
      type: function
      function: data_strategies.WebInstruct.utils.clean_dataset
      function_config:
        input_column: extracted_text
        output_column: cleaned_text
        remove_columns: [extracted_text]
    input_ids:
      - parse_stemez_html

  - id: filter_stemez_text
    config:
      type: function
      function: data_strategies.WebInstruct.utils.filter_if_contains
      function_config:
        input_column: cleaned_text
        phrase: "CONTENTS CHAPTER PREVIOUS NEXT PREP FIND PROBLEM"
    input_ids:
      - clean_stemez_text

  - id: remove_stemez_text
    config:
      type: function
      function: data_strategies.WebInstruct.utils.remove_text
      function_config:
        input_column: cleaned_text
        output_column: cleaned_text
        phrase: "CONTENTS CHAPTER PREVIOUS NEXT PREP FIND PROBLEM"
        num_truncate: 20_000
    input_ids:
      - filter_stemez_text

  - id: load_mathhelpforum_html
    config:
      type: json_source
      directory: gs://dcft-data-gcp/scraper/mathhelpforum/shards/
      num_truncate: 20_000

  - id: parse_mathhelpforum_html
    config:
      type: function
      function: data_strategies.WebInstruct.utils.parse_html
      function_config:
        input_column: html
        output_column: extracted_text
        remove_columns: [html, timestamp]
    input_ids:
      - load_mathhelpforum_html

  - id: clean_mathhelpforum_text
    config:
      type: function
      function: data_strategies.WebInstruct.utils.clean_dataset
      function_config:
        input_column: extracted_text
        output_column: cleaned_text
    input_ids:
      - parse_mathhelpforum_html

  - id: remove_mathhelpforum_text
    config:
      type: function
      function: data_strategies.WebInstruct.utils.remove_text
      function_config:
        input_column: cleaned_text
        output_column: cleaned_text
        phrase: "Register CTA Register on Math Help Forum! This sidebar will go away, and you will see fewer ads. Trending Discussions"
    input_ids:
      - clean_mathhelpforum_text

  - id: mix_fasttext_train_positive
    input_ids: ['remove_mathhelpforum_text', 'remove_stemez_text']
    config:
      type: mix 