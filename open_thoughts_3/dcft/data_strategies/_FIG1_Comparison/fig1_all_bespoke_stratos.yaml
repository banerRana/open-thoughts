operators:
- id: load_hf
  config:
    type: hf_source
    dataset: bespokelabs/Bespoke-Stratos-17k
    split: train
    trust_remote_code: True
- id: unravel_conversations
  config:
    type: function
    function: data_strategies.commons.convert_sharegpt_to_instruction_response
    function_config:
      input_sharegpt_column: conversations
      output_instruction_column: original_problem
      output_response_column: original_reasoning_trace
      role_tag: from
      user_tag: user
      content_tag: value
      assistant_tag: assistant
      drop_non_output_columns: True
  input_ids:
  - load_hf
- id: strip_problem
  config:
    type: function
    function: data_strategies.commons.strip_column
    function_config:
      input_column: original_problem
      strip_str: "Return your final response within \\boxed{}. "
      output_column: problem
  input_ids:
  - unravel_conversations
- id: decompose_reasoning_trace
  config:
    type: function
    function: data_strategies.commons.convert_final_to_reasoning_trace
    function_config:
      input_column: original_reasoning_trace
      output_reasoning_column: deepseek_reasoning
      output_solution_column: deepseek_solution
  input_ids:
  - strip_problem
- id: reassemble_reasoning_trace
  config:
    type: function
    function: data_strategies.commons.convert_reasoning_trace_to_final
    function_config:
      reasoning_column: deepseek_reasoning
      solution_column: deepseek_solution
      output_column: final_reasoning_trace
  input_ids:
  - decompose_reasoning_trace
# - id: decontaminate
#   config:
#     type: cpu_function
#     sharded: false
#     num_cpus: 16
#     function:  data_strategies._A1_Source.utils.decontaminate_fuzzy_w_ngram
#     function_config:
#       column: problem
#       eval_datasets:
#         - HuggingFaceH4/MATH-500
#         - Maxwell-Jia/AIME_2024
#         - AI-MO/aimo-validation-amc
#         - livecodebench/code_generation_lite
#         - mlfoundations-dev/AIME2025_combined
#         - cais/hle
#         - open-r1/codeforces
#         - Idavidrein/gpqa
#         - daman1209arora/jeebench
#         - mlfoundations-dev/mmlu_pro_eval_full
#         - Qwen/CodeElo
#         - open-r1/ioi
#       eval_columns:
#         - problem
#         - Problem
#         - problem
#         - question_content
#         - question
#         - question
#         - description
#         - Question
#         - question
#         - prompt
#         - description
#         - statement
#       eval_splits:
#         - test
#         - train
#         - train
#         - test
#         - train
#         - test
#         - test
#         - train
#         - test
#         - test
#         - test
#         - test
#       eval_subsets:
#         Idavidrein/gpqa: gpqa_diamond
#       similarity_threshold: 75.0
#       ngram_size: 13
#   input_ids:
#   - decompose_reasoning_trace
- id: convert_reasoning_trace_to_final
  config:
    type: function
    function: data_strategies.commons.convert_reasoning_trace_to_final
    function_config:
      reasoning_column: deepseek_reasoning
      solution_column: deepseek_solution
      output_column: final_reasoning_trace
  input_ids:
  - decompose_reasoning_trace
- id: convert_to_sharegpt
  config:
    type: function
    function: data_strategies.commons.convert_instruction_response_to_sharegpt
    function_config:
      input_instruction_column: problem
      input_response_column: final_reasoning_trace
      output_sharegpt_column: conversations
  input_ids:
    - convert_reasoning_trace_to_final