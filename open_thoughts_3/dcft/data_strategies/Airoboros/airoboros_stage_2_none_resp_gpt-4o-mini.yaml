# Stage 2: Embed and filter out similar instructions
operators:
- id: load_stage_1
  config:
    type: load_preexisting
    framework_name: airoboros_stage_1_none_resp_gpt-4o-mini
- id: embed_airoboros
  config:
    type: embedding
    model: thenlper/gte-small
    input_text_column: instruction
    output_embedding_column: embedding
    num_workers_per_shard: 50
  input_ids:
    - load_stage_1
- id: filter_similar_instructions
  config:
    type: similarity_filtering
    input_embedding_column: embedding
    input_min_distance_column: min_docsearch_score
    input_text_column: instruction
    output_similar_text_column: similar_instruction
    output_filter_decision_column: too_similar
    should_filter: true
  input_ids:
    - embed_airoboros