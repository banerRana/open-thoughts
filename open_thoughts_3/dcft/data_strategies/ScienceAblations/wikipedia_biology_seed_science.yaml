operators:
- id: load_hf
  config:
    type: hf_source
    dataset: mattany/wikipedia-biology
    split: train
- id: sample_dataset
  config:
    type: function
    function: data_strategies.commons.uniform_sample_fixed
    function_config:
      num_samples: 5_001
  input_ids:
  - load_hf
- id: generate_instructions
  config:
    type: completions
    map: chat
    map_config:
      system_message: "You are a helpful assistant."
      user_message: |
        You are to reform the following math text snippet into a question with a quantitative or verifiable answer such as one that would be 
        included in the Biology, Physics or Chemistry Olympiad. 

        Text: {{text}}
        
        Include only the new question or task. Do not include anything like "Here is the instruction". You can either extract a 
        question from the text or form a new one based on the text. Make the question sound like what a human would ask a language model. 
      output_column: problem
    model: gpt-4o-mini
    temperature: 1.0
    batch: False
  input_ids:
    - sample_dataset
# - id: annotate_r1_distill_70b
#   config:
#     type: completions
#     map: deepseek_reasoner
#     map_config:
#       input_problem_column: problem
#     model: deepseek-reasoner
#     batch: False
#     temperature: 1.0
#     backend: openai_client
#     backend_params:
#       max_requests_per_minute: 2_500
#       max_tokens_per_minute: 1_000_000_000
#       api_key: API_KEY
#       base_url: "https://api.deepseek.com/"
#       invalid_finish_reasons: ['content_filter']
#   input_ids:
#     - generate_instructions
# - id: convert_reasoning_trace_to_final
#   config:
#     type: function
#     function: data_strategies.commons.convert_reasoning_trace_to_final
#     function_config:
#       reasoning_column: reasoning
#       solution_column: deepseek_solution
#       output_column: final_reasoning_trace
#   input_ids:
#   - annotate_r1_distill_70b
# - id: convert_to_sharegpt
#   config:
#     type: function
#     function: data_strategies.commons.convert_instruction_response_to_sharegpt
#     function_config:
#       input_instruction_column: problem
#       input_response_column: final_reasoning_trace
#       output_sharegpt_column: conversations
#   input_ids:
#     - convert_reasoning_trace_to_final

