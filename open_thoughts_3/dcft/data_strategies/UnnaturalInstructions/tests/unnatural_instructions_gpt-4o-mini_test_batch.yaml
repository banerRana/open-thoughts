operators:
  - id: load_seed_instructions
    config:
      type: function
      function: data_strategies.UnnaturalInstructions.utils.load_seed_instructions
      function_config:
        seed_tasks_path: "dcft/data_strategies/UnnaturalInstructions/seed_tasks"

  - id: generate_instructions
    config:
      type: completions
      model: gpt-4o-mini
      map: unnatural_instructions
      map_config:
        system_message: "You are a helpful assistant."
        user_message: "{{seeds}}\n\nExample 4\n"
        output_instruction_column: instruction
        output_input_column: input
        output_constraints_column: constraints
        output_output_column: output
      top_p: 0.99
      n_repeat: 10
      batch: True
    input_ids:
      - load_seed_instructions
   
  - id: dedup_instructions
    config:
      type: function
      function: data_strategies.commons.dedup_on_columns
      function_config:
        dedup_columns: ["instruction"]
    input_ids:
      - generate_instructions

  - id: generate_outputs
    config:
      type: completions
      model: gpt-4o-mini
      map: chat
      map_config:
        system_message: "You are a helpful assistant."
        user_message: |
          Instruction: {{instruction}}
          Input: {{input}}
          Constraints: {{constraints}}
          Output:
        output_column: output
      top_p: 1
      temperature: 0
      batch: True
    input_ids:
      - dedup_instructions

  - id: delete_seeds_column
    config:
      type: function
      function: data_strategies.commons.remove_columns
      function_config:
        columns: seeds
    input_ids:
      - generate_outputs

  - id: generate_alternative_formulations
    config:
      type: completions
      model: gpt-4o-mini
      map: chat
      map_config:
        system_message: "You are a helpful assistant."
        user_message: |
          Example 1
          Instruction: In this task, you are given an article. Your task is to summarize the article in a sentence.
          Input: [INPUT]
          Alternative formulation: My college roommate asked me what this article means: [INPUT]. So I recapped it in layman's terms:

          Example 2
          Instruction: This task is about writing a correct answer for the reading comprehension task. Based on the information provided in a given passageâ€¦
          Input: [INPUT]
          Alternative formulation: [INPUT] Based on the given context, the answer to the question is

          Example 3
          Instruction: {{instruction}}
          Input: [INPUT]
          Alternative formulation:
        output_column: alternative_formulation
      batch: True
    input_ids:
      - delete_seeds_column

  - id: inline_input_in_instruction
    config:
      type: function
      function: data_strategies.UnnaturalInstructions.utils.inline_input_in_instruction
      n_repeat: 2
      batch: True
    input_ids:
      - generate_alternative_formulations

  - id: convert_to_sharegpt
    config:
      type: function
      function: data_strategies.commons.convert_instruction_response_to_sharegpt
      function_config:
        input_instruction_column: alternative_formulation_inlined
        input_response_column: output
        output_sharegpt_column: conversations
    input_ids:
      - inline_input_in_instruction
