operators:
  - id: load_preexisting
    config:
      type: load_preexisting
      framework_name: base_get_difficulty_seed_code
  - id: keep_only_few_columns
    config:
      type: function
      function: data_strategies.commons.keep_only_columns
      function_config:
        columns_to_keep:
          - problem
    input_ids:
      - load_preexisting
  - id: dedup_topics
    config:
      type: function
      function: data_strategies.commons.dedup_on_columns
      function_config:
        dedup_columns:
          - problem
    input_ids:
      - keep_only_few_columns
  - id: sample_dataset
    config:
      type: function
      function: data_strategies.commons.uniform_sample_fixed
      function_config:
        num_samples: 10
    input_ids:
      - dedup_topics
  - id: duplicate
    config:
      type: function
      function: data_strategies.TestTime.generator.duplicate_rows
      function_config:
        n_copies: 1
    input_ids:
      - sample_dataset
  - id: annotate
    config:
      type: completions
      map: chat
      map_config:
        user_message_column: problem
        output_column: r1_distill_70b_response
      model: "together_ai/deepseek-ai/DeepSeek-R1-Distill-Llama-70B"
      batch: False
      temperature: 1.0
      backend_params:
        max_requests_per_minute: 250
        max_tokens_per_minute: 500_000
        invalid_finish_reasons: ['content_filter']
      generation_params:
        max_tokens: 32_000
    input_ids:
      - duplicate
  - id: extract_code
    config:
      type: function
      function: data_strategies.MultipleSamples.code_sampling.auto_unit_test.zaid_unit_test.extract_code_from_model
      function_config:
        code_column: r1_distill_70b_response
        extraction_column: extracted_code
    input_ids:
      - annotate
  - id: filter_no_code
    config:
      type: function
      function: data_strategies.MultipleSamples.code_sampling.auto_unit_test.zaid_unit_test.filter_no_extract
      function_config:
        code_column: extracted_code
    input_ids:
      - extract_code
  - id: get_adversarial_test
    config:
      type: function
      function: data_strategies.MultipleSamples.code_sampling.auto_unit_test.zaid_unit_test.get_adversarial_test
      function_config:
        problem_column: problem
        code_column: extracted_code
    input_ids:
      - filter_no_code
  - id: annotate_adversarial_test
    config:
      type: completions
      map: chat
      map_config:
        user_message_column: _prompt_for_adversarial_test
        output_column: adversarial_test
      model: "gpt-4o-mini"
    input_ids:
      - get_adversarial_test
  - id:  get_input_output
    config:
      type: function
      function: data_strategies.MultipleSamples.code_sampling.auto_unit_test.zaid_unit_test.generate_input_output
      function_config:
        response_column: adversarial_test
    input_ids:
      - annotate_adversarial_test